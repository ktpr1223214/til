version: "3"
services:
  mysql:
    image: mysql:5.7
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: vuln
      TZ: Asia/Tokyo
    ports:
      - 3306:3306
    volumes:
      - ./mysql/my.cnf:/etc/mysql/conf.d/my.cnf
    container_name: mysql-vuln-db

  migration:
    build:
      context: ./migration
    command: ./wait-for-it.sh mysql-vuln-db:3306 -- migrate -path=./sql/ -database mysql://root:password@tcp(mysql-vuln-db:3306)/vuln up
    working_dir: /migration
    volumes:
      - ./migration/:/migration
    depends_on:
      - mysql

  #redis:
  #  image: redis:5.0
  #  ports:
  #    - 6379:6379