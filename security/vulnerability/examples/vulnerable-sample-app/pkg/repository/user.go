package repository

import (
	"context"
	"database/sql"
	"github.com/ktpr1223214/til/security/vulnerability/examples/vulnerable-sample-app/pkg/service"
	"github.com/pkg/errors"
)

type userRepository struct {
	db *sql.DB
}

func NewUserRepository(db *sql.DB) service.UserRepository {
	return &userRepository{
		db: db,
	}
}

func (u *userRepository) GetUsrPass(ctx context.Context, username string) (string, error) {
	query := "select password from users where username = ?"
	var expectedPass string
	if err := u.db.QueryRowContext(ctx, query, username).Scan(&expectedPass); err != nil {
		return "", errors.Wrapf(err, "failed to get password from user %s", username)
	}

	return expectedPass, nil
}
